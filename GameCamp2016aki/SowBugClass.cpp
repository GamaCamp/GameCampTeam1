#include "SowBugManagerClass.h"
#include <fstream>
#include <sstream>

#include "system.h"

//////////////////////////////////////////////////////////////////////////////
//SowBugStatePatternClass
//////////////////////////////////////////////////////////////////////////////

//コンストラクタ
SowBugStatePatternClass::SowBugStatePatternClass()
{
	m_ThrowedFlag = false;
}

//デストラクタ
SowBugStatePatternClass::~SowBugStatePatternClass()
{
}

//////////////////////////////////////////////////////////////////////////////
//protected関数
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
//概略:
//	データロード（純粋仮想関数）
//////////////////////////////////////////////////////////////////////////////
bool SowBugStatePatternClass::LoadSowBugData(POSITION* position , VELOCITY* velocity)
{
	return true;
}

//////////////////////////////////////////////////////////////////////////////
//public関数
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
//概略:
//	初期化（純粋仮想関数）
//////////////////////////////////////////////////////////////////////////////
bool SowBugStatePatternClass::Initialize(POSITION* position , VELOCITY* velocity)
{
	return true;
}

//////////////////////////////////////////////////////////////////////////////
//概略:
//	更新（純粋仮想関数）
//////////////////////////////////////////////////////////////////////////////
bool SowBugStatePatternClass::Update()
{
	return true;
}

//////////////////////////////////////////////////////////////////////////////
//概略:
//	描画（純粋仮想関数）
//////////////////////////////////////////////////////////////////////////////
void SowBugStatePatternClass::Render()
{
}

//////////////////////////////////////////////////////////////////////////////
//NormalSowBugClass
//////////////////////////////////////////////////////////////////////////////

//コンストラクタ
NormalSowBugClass::NormalSowBugClass()
{
}

//デストラクタ
NormalSowBugClass::~NormalSowBugClass()
{
}

//////////////////////////////////////////////////////////////////////////////
//private関数
//////////////////////////////////////////////////////////////////////////////

bool NormalSowBugClass::LoadSowBugData(POSITION* position , VELOCITY* velocity)
{
	std::ifstream ifs("data/normal_sow_bug.csv");
	if(ifs.fail()) return false;

	std::string SowBugData;
	for(int i = 0 ; i < 2 ; i++)
	{
		std::getline(ifs , SowBugData);
	}

	std::string token;
	std::istringstream stream(SowBugData);
	std::vector<double> TempVector;

	while (std::getline(stream , token , ','))
	{
		TempVector.push_back(std::stod(token));
	}

	if(TempVector[0] >= TempVector[1])
	{
		BoxClass::Initialize(position , velocity , &ACCELARATION() , &THREE_DIMENSION_VECTOR(TempVector[0]) , &THREE_DIMENSION_VECTOR(0 , TempVector[1]));
	}
	else
	{
		BoxClass::Initialize(position , velocity , &ACCELARATION() , &THREE_DIMENSION_VECTOR(0 ,TempVector[1]) , &THREE_DIMENSION_VECTOR(TempVector[0]));
	}

	m_Speed = TempVector[2];

	ReleaseVector(TempVector);

	return true;
}

//////////////////////////////////////////////////////////////////////////////
//public関数
//////////////////////////////////////////////////////////////////////////////

bool NormalSowBugClass::Initialize(POSITION* position , VELOCITY* velocity)
{
	LoadSowBugData(position , velocity);
	return true;
}

bool NormalSowBugClass::Update()
{
	MoveObject(m_GroundedFlag);
	return true;
}

void NormalSowBugClass::Render()
{
}

//////////////////////////////////////////////////////////////////////////////
//SowBugContextClass
//////////////////////////////////////////////////////////////////////////////

//コンストラクタ
SowBugContextClass::SowBugContextClass(void)
{
}

//デストラクタ
SowBugContextClass::~SowBugContextClass(void)
{
}

//////////////////////////////////////////////////////////////////////////////
//public関数
//////////////////////////////////////////////////////////////////////////////

POSITION SowBugContextClass::GetPosition()
{
	return m_SowBug->GetPosition();
}

bool SowBugContextClass::Initialize(int sow_bug_type , POSITION* position , VELOCITY* velocity)
{
	switch (sow_bug_type)
	{
	case SowBugManagerClass::E_NORMAL:
		m_SowBug = new NormalSowBugClass;
		break;
	}

	if(!m_SowBug->Initialize(position , velocity)) return false;
	return true;
}

bool SowBugContextClass::Update()
{
	m_SowBug->Update();
	return true;
}